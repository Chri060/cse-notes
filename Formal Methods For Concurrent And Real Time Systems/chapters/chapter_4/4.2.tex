\section{Transition systems refinement}

Transition systems can represent software or hardware at various levels of abstraction, where the level of detail included in the model depends on the purpose of the analysis. 
At lower levels of abstraction, more implementation details are included, while higher levels intentionally omit those details, focusing on the core behaviors of the system. 
This section discusses the processes of abstraction and refinement in transition systems and their role in preserving certain properties while simplifying or detailing the model.

The process of abstraction involves starting with a detailed transition system and creating a more abstract version, which may be easier to manage or reason about, while still preserving key properties of interest. 
This is often necessary for high-level analysis or verification tasks. On the other hand, refinement is the opposite process, where a more abstract model is made more detailed to reflect implementation specifics, without losing the essential properties.

Both abstraction and refinement are concerned with maintaining the correctness of a system while adjusting the level of detail, and this can be formally described using implementation relations.
These relations connect two transition systems at different levels of abstraction.
\begin{definition}[\textit{Implementation relation}]
    An implementation relation is a binary relation between two transition systems at different abstraction levels.
\end{definition}
\noindent When two transition systems, $\text{TS}_1$ and $\text{TS}_2$, are related by an implementation relation, one system is said to be refined by the other. 
The system that is more abstract is seen as an abstraction of the more detailed system. 
If the implementation relation is an equivalence, then the two systems are indistinguishable at the relevant level of abstraction, as they exhibit the same observable properties.

The set of atomic propositions plays a critical role in comparing transition systems. 
In bisimulation, $\text{AP}$ represents the relevant atomic propositions. 
Other propositions can be ignored if they do not affect the properties being studied.

When verifying the satisfaction of a temporal logic formula $\phi$, we can restrict the AP to those propositions that are relevant to the formula. 
This reduces the scope of the comparison and allows the verification of the formula in a more manageable way.

\subsection{Simulation}
While bisimulation relations require that two states exhibit identical stepwise behavior, simulation relations relax this requirement. 
A simulation relation only mandates that if a state $s^\prime$ simulates state $s$, then $s^\prime$ must mimic all transitions of $s$, but not necessarily vice versa. 
In other words, for each successor of $s$, there must be a corresponding successor of $s^\prime$, but not all successors of $s^\prime$ need to correspond to those of $s$.

Simulation relations are useful when we want to show that one system correctly implements another, more abstract system, or when we want to find a smaller abstract model that still preserves important properties.

\begin{definition}[\textit{Simulation}]
    Let $\text{TS}_1=\left\langle S_1,\text{Act}_1,\rightarrow_1,I_1,\text{AP},L_1\right\rangle$ and \\ $\text{TS}_2=\left\langle S_2,\text{Act}_2,\rightarrow_2,I_2,\text{AP},L_2\right\rangle$ be transition systems over $\text{AP}$. 
    A simulation for $(\text{TS}_1,\text{TS}_2)$ is a binary relation $\mathcal{R}\subseteq S_1\times S_2$ such that: 
    \begin{enumerate}
        \item For every initial state $\forall s_1\in I_1$, $s_2\in I_2$ such that $(s_1,s_2)\in \mathcal{R}$. 
        \item For all $(s_1,s_2)\in \mathcal{R}$, the following hold:
            \begin{enumerate}
                \item $L_1(s_1)=L_2(s_2)$
                \item If $s_1^\prime\in\text{post}(s_1)$, then there exists $s_2^\prime\in\text{post}(s_2)$ such that $(s_1^\prime,s_2\prime)\in\mathcal{R}$. 
            \end{enumerate}
    \end{enumerate}
    We say that $\text{TS}_1$ is simulated by $\text{TS}_2,$ denoted $\text{TS}_1 \preceq \text{TS}_2$, if there exists a bisimulation $\mathcal{R}$ for $(\text{TS}_1,\text{TS}_2)$. 
\end{definition}
\noindent The first condition ensures that every initial state in $\text{TS}_1$ is related to an initial state in $\text{TS}_2$, although there might be initial states in $\text{TS}_2$ that are not related to any initial state in $\text{TS}_1$. 
The second condition is similar to that of bisimulation, but the symmetric counterpart of the condition is not required.
In other words, while $\text{TS}_1$ may have some successors not matched by $\text{TS}_2$, every successor of $\text{TS}_1$ must have a corresponding successor in $\text{TS}_2$.






\subsection{Abstraction}
\begin{definition}[\textit{Refinement}]
    If $\text{TS}_1$ is obtained from $\text{TS}_2$ by deleting transitions, then $\text{TS}_1$ is simulated by $\text{TS}_2$. 
    This makes $\text{TS}_1$ a refinement of $\text{TS}_2$, as the nondeterminism in $\text{TS}_2$ is resolved in $\text{TS}_1$.
\end{definition}


\begin{definition}[\textit{Abstraction}]
    Conversely, if $\text{TS}_2$ is obtained from $\text{TS}_1$ by some form of abstraction, then $\text{TS}_1$ is simulated by $\text{TS}_2$.
    In this case, $\text{TS}_2$ abstracts away some of the details of $\text{TS}_1$.
\end{definition}
\noindent An abstraction of $\text{TS}_1$ to $\text{TS}_2$ requires:
\begin{itemize}
    \item A common set of atomic propositions (AP).
    \item The states of $\text{TS}_2$ are "abstract states".
    \item An abstraction function $f$ that associates each concrete state $s$ of $\text{TS}_1$ with the abstract state $f(s)$ of $\text{TS}_2$, respecting the labels in $\text{AP}$.
\end{itemize}
\noindent Abstractions may vary in terms of the choice of abstract states, the abstraction function $f$, and the relevant propositions in $\text{AP}$.




\subsection{Safety property}
A safety property is one that asserts that something bad will never happen. 
A key property of simulation relations is that they preserve safety properties.
\begin{property}
    Let $P_{\text{safe}}$ be a safety linear-time property, and let $\text{TS}_1$ and $\text{TS}_2$ be transition systems.
    Then:
    \[\text{TS}_1\preceq \text{TS}_2\land\text{TS}_2\models P_{\text{safe}}\implies\text{TS}_1\models P_{\text{safe}} \]
\end{property}
\noindent This means that if $\text{TS}_2$ satisfies a safety property and $\text{TS}_1$ is simulated by $\text{TS}_2$, then $\text{TS}_1$ will also satisfy the safety property.

\subsection{Path fragments}
\begin{definition}
    A path fragment is a finite part of a path in the transition system.
\end{definition}
\noindent The simulation relation preserves the set of finite path fragments, but it does not preserve entire paths that end in terminal states.
If a path fragment $p_1$ from state $s_1$ is simulated by a path fragment $p_2$ from state $s_2$, and $p_1$ ends in a terminal state, but $p_2$ does not, then: $p_1$ is a valid path in $\text{TS}_1$, but $p_2$ is not a valid path in  $\text{TS}_2$.

Simulation preserves the finite traces of the system, which correspond to the finite path fragments, but it does not preserve traces that involve terminal states.
If there are no terminal states in the transition system, simulation preserves all traces (including infinite traces) and not just the safety properties.

\subsection{Simulation quotient}
A simulation quotient is a reduced version of a transition system where simulation equivalence is used to merge equivalent states.
Given a transition system $\text{TS}$ and a simulation equivalence $\cong_{\text{TS}}$, we can define a quotient transition system $TS_{\setminus\cong}$, where equivalent states are merged.
The quotient system will have the same behavior as $\text{TS}$ with reduced state space.

\subsection{Atomic proposition determinism}
\begin{definition}[\textit{Atomic proposition determinism}]
    An Atomic proposition deterministic transition system $\text{TS}=\left\langle S,\text{Act},\rightarrow,I,\text{AP},L\right\rangle$ has the following properties: 
    \begin{enumerate}
        \item For any set $A\subseteq\text{AP}$, there is at most one initial state in $\text{TS}$ with label $A$.
        \item If a state $s$ can transition to two distinct states $s^\prime$ and $s^{\prime\prime}$ via the same action and with the same label, then $s^\prime=s^{\prime\prime}$.
    \end{enumerate}
\end{definition}
\begin{theorem}
    IF $\text{TS}_1$ and $\text{TS}_2$ are AP-determinstic, then $\text{TS}_1\sim\text{TS}_2$ if and only if $\text{TS}_1\simeq\text{TS}_2$. 
\end{theorem}
\noindent This means that for AP-deterministic systems, simulation equivalence implies bisimulation equivalence, and vice versa.

\subsection{Action based bisimulation}
While traditional bisimulation focuses on state labels, action-based bisimulation also takes into account the actions triggering transitions between states.
\begin{definition}[\textit{Action based bisimulation equivalence}]
    Let $\text{TS}_1=\left\langle S_1,\text{Act}_1,\rightarrow_1,I_1,\text{AP},L_1\right\rangle$ and $\text{TS}_2=\left\langle S_2,\text{Act}_2,\rightarrow_2,I_2,\text{AP},L_2\right\rangle$ be transition systems over a set of actions $\text{Act}$.
    An action-based bisimulation for $(\text{TS}_1,\text{TS}_2)$ is a binary relation $\mathcal{R}\subseteq S_1\times S_2$ such that: 
    \begin{enumerate}
        \item For each $s_1\in I_1$, there exists $s_2\in I_2$ such that $(s_1,s_2)\in\mathcal{R}$, and viceversa.
        \item For each pair $(s_1,s_2)$, the following hold:
            \begin{enumerate}
                \item If $s_1\overset{\alpha}{\rightarrow}s_1^\prime$, then $s_2\overset{\alpha}{\rightarrow}s_2^\prime$ with $(s_1^\prime,s_2^\prime)\in\mathcal{R}$ for some $s_2^\prime\in S_2$.
                \item If $s_2\overset{\alpha}{\rightarrow}s_2^\prime$, then $s_1\overset{\alpha}{\rightarrow}s_1^\prime$ with $(s_1^\prime,s_2^\prime)\in\mathcal{R}$ for some $s_1^\prime\in S_1$.
            \end{enumerate}
    \end{enumerate}
    $\text{TS}_1$ and $\text{TS}_2$ are action-based bisimulation equivalent, denoted $\text{TS}_1\sim^{\text{Act}}\text{TS}_2$, if there exists an action-based bisimulation $\mathcal{R}$ for $(\text{TS}_1,\text{TS}_2)$.
\end{definition}