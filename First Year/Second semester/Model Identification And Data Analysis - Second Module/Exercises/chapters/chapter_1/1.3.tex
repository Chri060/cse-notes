\section{Exercise three}

Given the transfer function:
\[W(z)=\dfrac{z+2}{\left(z+2\right)\left(z+\frac{1}{2}\right)}\]
\begin{enumerate}
    \item Derive the state space representation in controllable canonical form.
    \item Verify observability and reachability.
    \item Compute the first five samples of both $x(t)$ and $y(t)$ for the impulse response.
    \item Determine an analytical expression for $y(t)$ when the input is an impulse.
    \item Identify matrices $F$, $G$, and $H$ using the noise-free 4SID method.
    \item Calculate the transfer function from $\hat{F}$, $\hat{G}$, $\hat{H}$, and $\hat{D}$.
\end{enumerate}

\subsubsection*{Solution}
\begin{enumerate}
    \item The canonical form of the transfer function is:
        \[W(z)=\dfrac{z+2}{z^2+\frac{5}{3}z+1}\]
        The corresponding state space representation is:
        \[F=\begin{bmatrix} 0 & 1 \\ -1 & -\frac{5}{2} \end{bmatrix} \quad G=\begin{bmatrix} 0 \\ 1 \end{bmatrix} \quad H=\begin{bmatrix} 2 \\ 1 \end{bmatrix} \quad D=\begin{bmatrix} 0 \end{bmatrix}\]
    \item The observability matrix is given by:
        \[O_2=\begin{bmatrix} H \\ HF \end{bmatrix}=\begin{bmatrix} 2 & 1 \\ -1 & -\frac{1}{2} \end{bmatrix}\]
        Since the rank is one, the system is not fully observable.
        
        The reachability matrix is:
        \[R_2=\begin{bmatrix} F \\ FG \end{bmatrix}=\begin{bmatrix} 0 & 1 \\ 1 & -\frac{5}{2} \end{bmatrix}\]
        With a rank of two, the system is fully reachable.
    \item The state space representation can also be expressed as follows:
        \[\begin{cases}
            x_1(t+1)=x_2(t) \\
            x_2(t+2)=-x_1(t)-\frac{5}{2}x_2(t)+u(t) \\
            y(t)=2x_1(t)+x_2(t)
        \end{cases}\]
        We can obtain the impulse response using the difference equation. 
        Note that $u(0)=1$ and is null otherwise since it represents an impulse.
        \begin{table}[H]
            \centering
            \begin{tabular}{|c|c|c|c|}
            \hline
            \textit{$t$} & \textit{$x_1(t)$} & \textit{$x_2(t)$} & \textit{$y(t)$} \\ \hline
            \textit{0}   & 0                 & 0                 & 0               \\ \hline
            \textit{1}   & 0                 & 1                 & 1               \\ \hline
            \textit{2}   & 1                 & $-\frac{5}{2}$    & $-\frac{1}{2}$  \\ \hline
            \textit{3}   & $-\frac{5}{2}$    & $\frac{21}{4}$    & $\frac{1}{4}$   \\ \hline
            \textit{4}   & $\frac{21}{4}$    & $-\frac{85}{8}$   & $-\frac{1}{8}$  \\ \hline
            \end{tabular}
        \end{table}

    \item The simplified transfer function is:
        \[W(z)=\dfrac{z^{-1}}{1+\frac{1}{2}z^{-1}}\]
        Using the geometric series, we have:
        \begin{align*}
            W(z)    &=z^{-1}\sum_{k=0}^{+\infty}\left(-\dfrac{1}{2}z^{-1}\right)^k \\
                    &=z^{-1}\sum_{k=0}^{+\infty}\left(-\dfrac{1}{2}\right)^kz^{-k} \\
                    &=\sum_{k=0}^{+\infty}\left(-\dfrac{1}{2}\right)^kz^{-(k+1)}
        \end{align*}
        By defining $t=k+1$, we obtain:
        \begin{align*}
            W(z)    &=\sum_{k=0}^{+\infty}\left(-\dfrac{1}{2}\right)^kz^{-(k+1)} \\
                    &=\sum_{t=1}^{+\infty}\left(-\dfrac{1}{2}\right)^{t-1}z^{-t} \\
                    &=0z^{-1}\sum_{t=1}^{+\infty}\left(-\dfrac{1}{2}\right)^{t-1}z^{-t} \\
        \end{align*}
        The added term is to compensate for the sum starting from one instead of zero.
        The final result is:
        \[\omega(t)=\begin{cases}
            0 \qquad\qquad\qquad\: \text{if }t=0 \\
            \left(-\frac{1}{2}\right)^{t-1} \quad\qquad \text{if }t>0 \\
        \end{cases}\]
    \item Here are the steps to follow:
        \begin{enumerate}
            \item Compute the Hankel matrix of increasing order until it loses full rank:
                \[H_1=\begin{bmatrix} \omega(1) \end{bmatrix}=\begin{bmatrix} 1 \end{bmatrix}\]
                Since this matrix is full rank, we proceed:
                \[H_2=\begin{bmatrix} \omega(1) & \omega(2) \\ \omega(2) & \omega(3) \end{bmatrix}=\begin{bmatrix} 1 & -\frac{1}{2} \\ -\frac{1}{2} & \frac{1}{4} \end{bmatrix}\]
                This matrix is not full rank, indicating that the system order is $n=1$.
            \item Factorize $H_2$.
                Using the first row of $H_2$ as $R_2$:
                \[R_2=\begin{bmatrix} 1 & -\frac{1}{2} \end{bmatrix}\]
                From the relation $H_2=O_2R_2$, we find:
                \[O_2=\begin{bmatrix} 1 \\ -\frac{1}{2} \end{bmatrix}\]
            \item Compute the system matrices.
                \[\hat{H}=O_2(1,:)=\begin{bmatrix} 1 \end{bmatrix}\]
                \[\hat{G}=R_2(:,1)=\begin{bmatrix} 1 \end{bmatrix}\]
                \[\hat{F}=O_2(1,:)^{-1}O_2(2,:)=\begin{bmatrix} -\frac{1}{2} \end{bmatrix}\]
                \[\hat{D}=\begin{bmatrix} 0 \end{bmatrix}\]
        \end{enumerate}
    \item The transfer function is: 
        \[W(z)=\hat{H}\left(zI-\hat{F}\right)^{-1}\hat{G}+\hat{D}=\dfrac{1}{z+\frac{1}{2}}\]
\end{enumerate}