\section{Exercise 4}

Consider the following code:
\begin{verbnobox}[\verbarg]
LW F1, 0(R0)
FADDI F1, F1, C1
FADDI F2, F1, C2
SW F2, 0(R0)
LW F2, 4(R0)
FADD F2, F2, F2
SW F2, 4(R0)
\end{verbnobox}
We have that 4 Floating Point ALU with 2 clock cycles latency, single write port for the pool, 4 Load Store unit with 4 clock cycles latency. 
\begin{enumerate}
    \item Identify all conflicts.
    \item Develop a scoreboard for the given code, indicating clock cycles.
    \item Develop a scoreboard for the given code, indicating clock cycles and with Register Renaming.
\end{enumerate}
COnsider a cache miss for the first instruction with a penalty of 2 clock cycles and a cache miss for the fifth instruction with a penalty of 5 clock cycles.

\subsection*{Solution}
\begin{enumerate}
    \item Conflicts:
        \begin{itemize}
            \item RAW F1 I1-I2.
            \item RAW F1 I2-I3.
            \item RAW F2 I3-I4.
            \item RAW F2 I6-I7.
            \item RAW F2 I5-I6.
            \item WAW F2 I5-I6.
            \item WAW F2 I5-I3.
            \item WAW F1 I2-I1.
            \item WAW F2 I6-I3.
            \item WAR F2 I4-I5.
            \item WAR F2 I4-I6.
        \end{itemize}
    \item Scoreboard:
        \begin{table}[H]
            \centering
            \begin{tabular}{c|cccc|c}
            \textbf{Instruction}      & \textbf{Issue} & \textbf{Read} & \textbf{Execution} & \textbf{Write} & \textbf{Unit} \\ \hline
            \textit{LW F1, 0(R0)}     & 1              & 2             & 8                  & 9              & LDU1          \\
            \textit{FADDI F1, F1, C1} & 10             & 11            & 13                 & 14             & FPU1          \\
            \textit{FADDI F2, F1, C2} & 11             & 15            & 17                 & 18             & FPU2          \\
            \textit{SW F2, 0(R0)}     & 12             & 19            & 13                 & 24             & LDU2          \\
            \textit{LW F2, 4(R0)}     & 19             & 20            & 29                 & 30             & LDU3          \\
            \textit{FADD F2, F2, F2}  & 31             & 32            & 34                 & 35             & FPU3          \\
            \textit{SW F2, 4(R0)}     & 32             & 36            & 40                 & 41             & LDU4         
            \end{tabular}
        \end{table}
    \item Scoreboard with Register Renaming: 
        \begin{table}[H]
            \centering
            \begin{tabular}{c|cccc|c}
            \textbf{Instruction}      & \textbf{Issue} & \textbf{Read} & \textbf{Execution} & \textbf{Write} & \textbf{Unit} \\ \hline
            \textit{LW F1, 0(R0)}     & 1              & 2             & 8                  & 9              & LDU1          \\
            \textit{FADDI F1, F1, C1} & 2              & 10            & 12                 & 13             & FPU1          \\
            \textit{FADDI F2, F1, C2} & 3              & 14            & 16                 & 17             & FPU2          \\
            \textit{SW F2, 0(R0)}     & 4              & 18            & 22                 & 23             & LDU2          \\
            \textit{LW F2, 4(R0)}     & 5              & 6             & 15                 & 16             & LDU3          \\
            \textit{FADD F2, F2, F2}  & 6              & 20            & 22                 & 23             & FPU3          \\
            \textit{SW F2, 4(R0)}     & 7              & 24            & 28                 & 29             & LDU4         
            \end{tabular}
        \end{table}
\end{enumerate}