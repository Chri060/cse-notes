\section{Exercise 4}

Consider the given program:
\begin{verbnobox}[\verbarg]
ADD T1, T0, T1
ADD T2, T1, T2
SUBI T0, T2, 1
SW T0, 0x00BB(T2)
BEQ T0, T2, 0x0089   
\end{verbnobox}
Assuming no forwarding, register file access with read/write optimization, and control hazards solved in the ID stage:
\begin{enumerate}
    \item Define all dependencies and analyze whether they cause hazards and the theoretical amount of stalls.
    \item Draw the effective pipeline schema. 
    \item Draw the effective pipeline schema assuming EX/EX, MEM/EX, and MEM/MEM forwarding paths are available. 
    \item Draw the effective pipeline schema assuming that the previous forwarding paths with also EX/ID are available.
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The potential issues are:
        \begin{table}[H]
            \centering
            \begin{tabular}{ccccc}
            \hline
            \makecell{\textbf{Instruction} \\ \textbf{number}}& \makecell{\textbf{Instruction} \\ \textbf{dependency}} & \makecell{\textbf{Register} \\ \textbf{involved}} & \textbf{Hazard} & \textbf{Stalls} \\ \hline
            i2                         & i1                                 & T1                       & yes             & 2               \\
            i3                         & i2                                 & T2                       & yes             & 2               \\
            i4                         & i2                                 & T2                       & yes             & 1               \\
            i4                         & i3                                 & T0                       & yes             & 2               \\
            i5                         & i2                                 & T2                       & no              & 0               \\
            i5                         & i3                                 & T0                       & yes             & 1               \\ \hline
            \end{tabular}%
        \end{table}
    \item The requested pipeline schema with stalls is as follows:
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{c|cccccccccccccccc|}
            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} & \textbf{C10} & \textbf{C11} & \textbf{C12} & \textbf{C13} & \textbf{C14} & \textbf{C15} \\ \hline
            \textit{ADD T1, T0, T1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             &              &              &              &              &              &              \\ 
            \textit{ADD T2, T1, T2}   &             & IF          & \underline{S}       & \underline{S}       & ID          & EX          & M           & WB          &             &              &              &              &              &              &              \\ 
            \textit{SUBI T0, T2, 1}     &             &             & \underline{S}       & \underline{S}       & IF          & \underline{S}       & \underline{S}       & ID          & EX          & M            & WB           &              &              &              &              \\ 
            \textit{SW T0, 0$\times$00BB (T2)}  &             &             &             &             &             & \underline{S}       & \underline{S}       & IF          & \underline{S}       & \underline{S}        & ID           & EX           & M            & WB           &              \\ 
            \textit{BEQ T0, T2, 0$\times$0089} &             &             &             &             &             &             &             &             & \underline{S}       & \underline{S}        & IF           & ID           & EX           & M            & WB           \\ 
            \end{tabular}%
            }
        \end{table}
    \item The requested pipeline schema with forwarding is as follows:
        \begin{table}[H]
            \centering
            \begin{tabular}{c|ccccccccccc}

            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} & \textbf{C10} \\ \hline
            \textit{ADD T1, T0, T1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             &              \\ 
            \textit{ADD T2, T1, T2}   &             & IF          & ID          & EX          & M           & WB          &             &             &             &              \\ 
            \textit{SUBI T0, T2, 1}     &             &             & IF          & ID          & EX          & M           & WB          &             &             &              \\ 
            \textit{SW T0, 0$\times$00BB (T2)}  &             &             &             & IF          & ID          & EX          & M           & WB          &             &              \\ 
            \textit{BEQ T0, T2, 0$\times$0089} &             &             &             &             & IF          & \underline{S}      & ID          & EX          & M           & WB           \\ 
            \end{tabular}
        \end{table}
    \item The requested pipeline schema with forwarding and EX/ID is:
        \begin{table}[H]
            \centering
            \begin{tabular}{c|cccccccccc}
            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} \\ \hline
            \textit{ADD T1, T0, T1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             \\ 
            \textit{ADD T2, T1, T2}   &             & IF          & ID          & EX          & M           & WB          &             &             &             \\ 
            \textit{SUBI T0, T2, 1}     &             &             & IF          & ID          & EX          & M           & WB          &             &             \\ 
            \textit{SW T0, 0$\times$00BB (T2)}  &             &             &             & IF          & ID          & EX          & M           & WB          &             \\ 
            \textit{BEQ T0, T2, 0$\times$0089} &             &             &             &             & IF          & ID          & EX          & M           & WB          \\ 
            \end{tabular}
        \end{table}
\end{enumerate}