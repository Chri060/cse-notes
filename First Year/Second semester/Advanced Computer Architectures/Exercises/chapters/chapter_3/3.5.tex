\section{Exercise 5}

Consider now the code:
\begin{verbnobox}[\verbarg]
ADDI S3, S2, 2
ADD S5, S4, S3
SW S5, 4(S3)
SUB S7, S5, S6
LS S6, 4(S7)
\end{verbnobox}
\begin{enumerate}
    \item Find the conflicts. 
    \item Simple Pipelining. 
    \item Reschedule the instructions to reduce the stalls; draw the pipeline schema showing all the data dependencies.
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The conflicts are: 
        \begin{itemize}
            \item RAW S3 I1-I2.
            \item RAW S7 I4-I5.
            \item RAW S5 I2-I3.
            \item RAW S3 I1-I3.
            \item RAW S5 I2-I4.
        \end{itemize}
    \item With simple pipelining we have: 
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{l|ccccccccccccccc}
            \textbf{Instruction}    & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} & \textbf{5} & \textbf{6} & \textbf{7} & \textbf{8} & \textbf{9} & \textbf{10} & \textbf{11} & \textbf{12} & \textbf{13} & \textbf{14} & \textbf{15} \\ \hline
            \textit{ADDI S3, S2, 2} & IF         & ID         & EX         & MEM        & WB         &            &            &            &            &             &             &             &             &             &             \\
            \textit{ADD S5, S4, S3} &            & IF         & {\underline{S}}    & {\underline{S}}    & ID         & EX         & MEM        & WB         &            &             &             &             &             &             &             \\
            \textit{SW S5, 4(S3)}   &            &            & {\underline{S}}    & {\underline{S}}    & IF         & {\underline{S}}    & {\underline{S}}    & ID         & EX         & MEM         & WB          &             &             &             &             \\
            \textit{SUB S7, S5, S6} &            &            &            &            & {\underline{}}     & {\underline{S}}    & {\underline{S}}    & IF         & ID         & EX          & MEM         & WB          & {\underline{}}      &             &             \\
            \textit{LS S6, 4(S7)}   &            &            &            &            &            &            &            &            & IF         & {\underline{S}}     & {\underline{S}}     & ID          & EX          & MEM         & WB         
            \end{tabular}%
            }
        \end{table}
    \item By using forwarding paths we have: 
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{l|ccccccccc|l}
            \textbf{Instruction}    & \textbf{1} & \textbf{2} & \textbf{3} & \textbf{4} & \textbf{5} & \textbf{6} & \textbf{7} & \textbf{8} & \textbf{9} & \textbf{Forwarding path} \\ \hline
            \textit{ADDI S3, S2, 2} & IF         & ID         & EX         & MEM        & WB         &            &            &            &            &                          \\
            \textit{ADD S5, S4, S3} &            & IF         & ID         & EX         & MEM        & WB         &            &            &            & EX-EX                    \\
            \textit{SW S5, 4(S3)}   &            &            & IF         & ID         & EX         & MEM        & WB         &            &            & MEM-EX, MEM-MEM          \\
            \textit{SUB S7, S5, S6} &            &            &            & IF         & ID         & EX         & MEM        & WB         &            & MEM-EX                   \\
            \textit{LS S6, 4(S7)}   &            &            &            &            & IF         & ID         & EX         & MEM        & WB         & EX-EX                   
            \end{tabular}%
            }
        \end{table}
\end{enumerate}

