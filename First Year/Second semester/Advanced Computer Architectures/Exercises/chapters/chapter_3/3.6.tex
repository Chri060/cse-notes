\section{Exercise 6}

Assuming the following:
\begin{itemize}
    \item All functional units are pipelined.
    \item ALU operations take 1 cycle.
    \item Memory operations take 2 cycles (includes time in ALU).
    \item Floating-point add instructions take 2 cycles.
    \item Floating-point multiply instructions take 3 cycles.
    \item There is no register renaming. No forwarding.
    \item Instructions are fetched, decoded and issued in order.
    \item The ISSUE stage is a buffer of unlimited length that holds instructions waiting to start execution.
    \item An instruction will only enter the issue stage if it does not cause a WAR or WAW hazard.
    \item Only one instruction can be issued at a time, and in the case multiple instructions are ready, the oldest one will go first.
    \item Program Counter calculation for branches and jumps has been anticipated in the ISSUE stage.
\end{itemize}
Consider the code:
\begin{verbnobox}[\verbarg]
LOOP:   LD F1, 0 (R2)
        MULTD F2, F1, F1
        ADDD F3, F1, F5
        MULTD F2, F3, F1
        SUBD F5, F1, F5
        SUBI R2, R2, 4
        BNEZ R2, LOOP
\end{verbnobox}
Examine each conflict considering the operation durations:
\begin{itemize}
    \item ALU OP: 1 cycle
    \item MEM OP: 2 cycles
    \item FP ADD: 2 cycles
    \item FP MULT: 3 cycles
\end{itemize}
\begin{enumerate}
    \item Find the conflicts.
    \item Compute the pipeline schema.
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The conflicts are: 
        \begin{itemize}
            \item RAW F1 I1-I2.
            \item RAW F1 I1-I3.
            \item RAW F1 I1-I4.
            \item RAW F1 I1-I5.
            \item RAW F3 I3-I4.
            \item RAW R2 I6-I7.
            \item WAW F2 I2-I4.
            \item WAR F5 I3-I5.
            \item WAR R2 I1-I6.
            \item CNTRL.
        \end{itemize}
    \item The pipeline schema is the following: 
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{l|cccccccccllllllllll}
            \textbf{Instruction}      & \textbf{1}           & \textbf{2}           & \textbf{3}           & \textbf{4}           & \textbf{5}           & \textbf{6}           & \textbf{7}           & \textbf{8}           & \textbf{9}           & \textbf{10} & \textbf{11} & \textbf{12} & \textbf{13} & \textbf{14} & \textbf{15} & \textbf{16} & \textbf{17} & \textbf{18} & \textbf{19} \\ \hline
            \textit{LD F1, 0 (R2)}    & F                    & D                    & IS                   & E1                   & E2                   & W                    &                      &                      &                      &             &             &             &             &             &             &             &             &             &             \\
            \textit{MULTD F2, F1, F1} &                      & F                    & D                    & {\underline{S}}              & {\underline{S}}              & IS                   & E1                   & E2                   & E3                   & W           &             &             &             &             &             &             &             &             &             \\
            \textit{ADDD F3, F1, F5}  &                      &                      & F                    & D                    & {\underline{S}}              & {\underline{S}}              & IS                   & E1                   & E2                   & {\underline{S}}     & W           &             &             &             &             &             &             &             &             \\
            \textit{MULTD F2, F3, F1} &                      &                      &                      & F                    & {\underline{S}}              & {\underline{S}}              & {\underline{S}}              & {\underline{S}}              & D                    & {\underline{S}}     & IS          & E1          & E2          & E3          & W           &             &             &             &             \\
            \textit{SUBD F5, F1, F5}  &                      &                      &                      &                      & {\underline{S}}              & {\underline{S}}              & {\underline{S}}              & {\underline{S}}              & F                    & D           & {\underline{S}}     & IS          & E1          & E2          & {\underline{S}}     & W           &             &             &             \\
            \textit{SUBI R2, R2, 4}   & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & F           & D           & {\underline{S}}     & IS          & E1          & {\underline{S}}     & {\underline{S}}     & W           &             &             \\
            \textit{BNEZ R2, LOOP}    & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} &             & F           & D           & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & IS          & E1          & W           \\
            \textit{CNTRL}            & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} &             &             & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & {\underline{S}}     & F           & D          
            \end{tabular}%
            }
        \end{table}
\end{enumerate}