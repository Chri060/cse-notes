\section{Exercise one}

Consider the given program:
\begin{verbatim}
i1: add $t1, $t0, $t1
i2: add $t2, $t1, $t2
i3: subi $t0, $t2, 1
i4: sw $t0, 0x00BB($t2)
i5: beq $t0, $t2, 0x0089   
\end{verbatim}
Assuming no forwarding, register file access with read/write optimization, and control hazards solved in the instruction decode stage (ID):
\begin{enumerate}
    \item Define all conflicts/dependencies and analyze whether they cause hazards and the theoretical amount of stalls.
    \item Draw the effective pipeline schema:
    \item Draw the effective pipeline schema assuming EX/EX, MEM/EX, and MEM/MEM forwarding paths are available. 
    \item Draw the effective pipeline schema assuming that the previous forwarding paths with also EX/ID are available.
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The potential issues are:
        \begin{table}[H]
            \centering
            \begin{tabular}{ccccc}
            \hline
            \makecell{\textbf{Instruction} \\ \textbf{number}}& \makecell{\textbf{Instruction} \\ \textbf{dependency}} & \makecell{\textbf{Register} \\ \textbf{involved}} & \textbf{Hazard} & \textbf{Stalls} \\ \hline
            i2                         & i1                                 & \$t1                       & yes             & 2               \\
            i3                         & i2                                 & \$t2                       & yes             & 2               \\
            i4                         & i2                                 & \$t2                       & yes             & 1               \\
            i4                         & i3                                 & \$t0                       & yes             & 2               \\
            i5                         & i2                                 & \$t2                       & no              & 0               \\
            i5                         & i3                                 & \$t0                       & yes             & 1               \\ \hline
            \end{tabular}%
        \end{table}
    \item The requested pipeline schema with stalls is as follows:
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{c|cccccccccccccccc|}
            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} & \textbf{C10} & \textbf{C11} & \textbf{C12} & \textbf{C13} & \textbf{C14} & \textbf{C15} \\ \hline
            \textit{add \$t1, \$t0, \$t1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             &              &              &              &              &              &              \\ 
            \textit{add \$t2, \$t1, \$t2}   &             & IF          & \underline{S}       & \underline{S}       & ID          & EX          & M           & WB          &             &              &              &              &              &              &              \\ 
            \textit{subi \$t0, \$t2, 1}     &             &             & \underline{S}       & \underline{S}       & IF          & \underline{S}       & \underline{S}       & ID          & EX          & M            & WB           &              &              &              &              \\ 
            \textit{sw \$t0, 0$\times$00BB (\$t2)}  &             &             &             &             &             & \underline{S}       & \underline{S}       & IF          & \underline{S}       & \underline{S}        & ID           & EX           & M            & WB           &              \\ 
            \textit{beq \$t0, \$t2, 0$\times$0089} &             &             &             &             &             &             &             &             & \underline{S}       & \underline{S}        & IF           & ID           & EX           & M            & WB           \\ 
            \end{tabular}%
            }
        \end{table}
    \item The requested pipeline schema with forwarding is as follows:
        \begin{table}[H]
            \centering
            \begin{tabular}{c|ccccccccccc}

            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} & \textbf{C10} \\ \hline
            \textit{add \$t1, \$t0, \$t1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             &              \\ 
            \textit{add \$t2, \$t1, \$t2}   &             & IF          & ID          & EX          & M           & WB          &             &             &             &              \\ 
            \textit{subi \$t0, \$t2, 1}     &             &             & IF          & ID          & EX          & M           & WB          &             &             &              \\ 
            \textit{sw \$t0, 0$\times$00BB (\$t2)}  &             &             &             & IF          & ID          & EX          & M           & WB          &             &              \\ 
            \textit{beq \$t0, \$t2, 0$\times$0089} &             &             &             &             & IF          & \underline{S}      & ID          & EX          & M           & WB           \\ 
            \end{tabular}
        \end{table}
    \item The requested pipeline schema with forwarding and EX/ID is:
        \begin{table}[H]
            \centering
            \begin{tabular}{c|cccccccccc}
            \textbf{Instruction}          & \textbf{C1} & \textbf{C2} & \textbf{C3} & \textbf{C4} & \textbf{C5} & \textbf{C6} & \textbf{C7} & \textbf{C8} & \textbf{C9} \\ \hline
            \textit{add \$t1, \$t0, \$t1}   & IF          & ID          & EX          & M           & WB          &             &             &             &             \\ 
            \textit{add \$t2, \$t1, \$t2}   &             & IF          & ID          & EX          & M           & WB          &             &             &             \\ 
            \textit{subi \$t0, \$t2, 1}     &             &             & IF          & ID          & EX          & M           & WB          &             &             \\ 
            \textit{sw \$t0, 0$\times$00BB (\$t2)}  &             &             &             & IF          & ID          & EX          & M           & WB          &             \\ 
            \textit{beq \$t0, \$t2, 0$\times$0089} &             &             &             &             & IF          & ID          & EX          & M           & WB          \\ 
            \end{tabular}
        \end{table}
\end{enumerate}