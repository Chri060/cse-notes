\section{Exercise 4}

Consider the following code: 
\begin{verbnobox}[\verbarg]
LOOP:   MULTD F2, F6, F8
        ADDD F0, F6, F4
        MULTD F10, F0, F2
        ADDD F0, F12, F14
        SUBI R0, R0, 4
        BNEZ R0, LOOP
\end{verbnobox}
We have: 
\begin{itemize}
    \item 3 Reservation Stations (RS1, RS2, RS3) with 3 MULT units (MULT1,MULT2, MULT3) with 4 clock cycles latency.
    \item 2 Reservation Stations (RS4, RS5, RS6) with 3 ADDD units (ADDD1, ADDD2, ADDD3) with 2 clock cycles latency.
    \item A reorder buffer with seven slots. 
\end{itemize}
In the case of hazard on CDB, the oldest instruction has priority.
Let's assume that we discover the BNEZ misprediction 5 clock cycles after the issue.
\begin{enumerate}
    \item Find all the conflicts. 
    \item Apply the Tomasulo algorithm wit Reorder buffer. 
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The conflicts are the following: 
        \begin{itemize}
            \item RAW F2 I1-I3.
            \item RAW F0 I2-I3.
            \item RAW R0 I5-I6.
            \item WAW F0 I2-I4.
            \item WAR F0 I3-I4.
        \end{itemize}
    \item The final result of the Tomasulo algorithm is: 
        \begin{table}[H]
            \centering
            \resizebox{\textwidth}{!}{%
            \begin{tabular}{l|ccccc|ccc}
            \multicolumn{1}{c|}{\textbf{Instruction}} & \textbf{Issue} & \textbf{Execution} & \textbf{Write} & \textbf{Commit} & \textbf{ROB} & \textbf{Hazards}            & \textbf{RS} & \textbf{Unit} \\ \hline
            \textit{MULTD F2, F6, F8}                 & 1              & 2                  & 6              & 7               & 0            &                             & RS1         & MULT1         \\
            \textit{ADDD F0, F6, F4}                  & 2              & 3                  & 5              & 8               & 1            &                             & RS4         & ADDD1         \\
            \textit{MULTD F10, F0, F2}                & 3              & 7                  & 11             & 12              & 2            & \makecell{RAW F2 \\ RAW F0} & RS2         & MULT2         \\
            \textit{ADDD F0, F12, F14}                & 4              & 5                  & 7              & 13              & 3            &                             & RS5         & ADDD2         \\
            \textit{MULTD F2, F6, F8}                 & 7              & 8                  &                &                 & 6            &                             & RS1         & MULT1         \\
            \textit{ADDD F0, F6, F4}                  & 8              & 9                  &                &                 & 0            & struct CDB                  & RS4         & ADDD1         \\
            \textit{MULTD F10, F0, F2}                & 9              &                    &                &                 & 1            & \makecell{RAW F2 \\ RAW F0} & RS3         &               \\
            \textit{ADDD F0, F12, F14}                &                &                    &                &                 &              & struct ROB                  &             &              
            \end{tabular}%
            }
        \end{table}
        The second iteration of the loop has ben flushed since we hade more that 5 clock cycles of misprediction.
\end{enumerate}