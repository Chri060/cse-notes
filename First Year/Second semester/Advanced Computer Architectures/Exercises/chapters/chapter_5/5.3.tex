\section{Exercise 3}

Consider the following code: 
\begin{verbnobox}[\verbarg]
LW F1, 0(R0)
FADDI F1, F1, C1
FADDI F2, F1, C2
SW F2, 0(R0)
LW F2, 4(R0)
FADD F2, F2, F2
SW F2, 4(R0)
\end{verbnobox}
We have: 
\begin{itemize}
    \item 2 Reservation Stations (RS1, RS2) with 1 Load Store unit (LDU1) with 4 clock cycles latency
    \item 2 Reservation Stations (RS3, RS4) with 1 Integer ALU (ALU1) with 2 clock cycles latency
\end{itemize}
\begin{enumerate}
    \item Find all the conflicts. 
    \item Apply the Tomasulo algorithm. 
\end{enumerate}

\subsection*{Solution}
\begin{enumerate}
    \item The conflicts are the following: 
        \begin{itemize}
            \item RAW F1 I1-I2.
            \item RAW F1 I2-I3.
            \item RAW F2 I3-I4.
            \item RAW F2 I6-I7.
            \item RAW F2 I5-I6.
            \item WAW F2 I5-I6.
            \item WAW F2 I5-I3.
            \item WAW F1 I2-I1.
            \item WAW F2 I6-I3.
            \item WAR F2 I4-I5.
            \item WAR F2 I4-I6.
        \end{itemize}
    \item The final result of Tomasulo is: 
            \begin{table}[H]
                \centering
                \begin{tabular}{l|ccc|ccc}
                \multicolumn{1}{c|}{\textbf{Instruction}} & \textbf{Issue} & \textbf{Execution} & \textbf{Write} & \textbf{Hazards}                               & \textbf{RS} & \textbf{Unit} \\ \hline
                \textit{LW F1, 0(R0)}                     & 1              & 2                  & 6              &                                                & RS1         & LDU1          \\
                \textit{FADDI F1, F1, C1}                 & 2              & 7                  & 9              & RAW F1                                         & RS3         & ALU1          \\
                \textit{FADDI F2, F1, C2}                 & 3              & 10                 & 12             & \makecell{RAW F1 \\ struct ALU1}               & RS4         & ALU1          \\
                \textit{SW F2, 0(R0)}                     & 4              & 14                 & 18             & \makecell{RAW F2 \\ struct LDU1}               & RS2         & LDU1          \\
                \textit{LW F2, 4(R0)}                     & 7              & 8                  & 13             & \makecell{struct RS1 \\ struct CDB}            & RS1         & LDU1          \\
                \textit{FADD F2, F2, F2}                  & 10             & 14                 & 16             & \makecell{struct RS3 \\ RAW F2 \\ struct ALU1} & RS3         & ALU1          \\
                \textit{SW F2, 4(R0)}                     & 14             & 19                 & 23             & \makecell{struct RS1 \\ RAW F2 \\ struct LDU1} & RS1         & LDU1         
                \end{tabular}
            \end{table}
\end{enumerate}