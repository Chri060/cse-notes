\section{Exercise 3}

A table STUDENT(StudID, SSN, LastName, FirstName, City, Faculty) has twenty thousand tuples and four indices with composite keys (attributes ordered left to right):
\begin{itemize}
    \item $IDX_1$(StudID, SSN, Faculty).
    \item $IDX_2$(LastName, FirstName, City).
    \item $IDX_3$(Faculty, City, LastName).
    \item $IDX_4$(Faculty, LastName, City).
\end{itemize}
Assuming uniform distribution of values for non-unique attributes, with:
\begin{itemize}
    \item $\text{val}(\text{LastName}) = 5000$.
    \item $\text{val}(\text{FisrtName}) = 1000$.
    \item $\text{val}(\text{City}) = 1000$.
    \item $\text{val}(\text{Faculty}) = 10$.
\end{itemize}
\begin{enumerate}
    \item Choose the best index for the following query:
        \begin{lstlisting}[style=SQL]
SELECT * 
FROM STUDENT
WHERE City = 'Milan' AND Faculty = 'Computer Science'
        \end{lstlisting}
    \item What if the query also had a selection on the LastName?
\end{enumerate}

\paragraph*{Solution}
\begin{enumerate}
    \item The where clause is a conjunction of supported predicates.
        We estimate the selectivity allowed by each of the available indexes, only considering the predicates mentioned in the where clause:
        \begin{itemize}
            \item $IDX_1$: there is no condition on StudID, so in this case we will have to follow all the pointer starting with StudID. 
                As a result it would force a full sequential scan of the table.
            \item $IDX_2$: there is no condition on LastName, so in this case we will have to follow all the pointer starting with LastName. 
                As a result it would force a full sequential scan of the table.
            \item $IDX_3$: the average number of candidate tuples is: 
                \[\dfrac{\left\lvert R \right\rvert }{\text{val}(\text{Faculty}) \cdot \text{val}(\text{City}) }=\dfrac{20000}{10 \cdot 1000}=2\]
                We excluded the LastName attribute since there is no restriction on it. 
            \item $IDX_4$: the average number of candidate tuples is: 
                \[\dfrac{\left\lvert R \right\rvert }{\text{val}(\text{Faculty}) \cdot \text{val}(\text{City}) }=\dfrac{20000}{10 \cdot 1000}=2\]
                We excluded the LastName attribute since there is no restriction on it. 
        \end{itemize}
        The best index is the more selective one, in this case we have that it is $IDX_3$. 
    \item We estimate the selectivity allowed by each of the available indexes, only considering the predicates mentioned in the where clause as before. 
        In this case we obtain 0.0004 tuples for both the third and the fourth indexes, but we choose the $IDX_4$ since it is more selective (LastName more selective than City)
\end{enumerate}