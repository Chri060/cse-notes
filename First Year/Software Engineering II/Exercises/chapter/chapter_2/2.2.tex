\section{Alloy}

The company \texttt{TravelSpaces} decides to help tourists visiting a city in finding places that can keep their luggage 
for some time. The company establishes agreements with small shops in various areas of the city and 
acts as a mediator between these shops and the tourists that need to leave their luggage in a safe
place. To this end, the company wants to build a system, called \texttt{LuggageKeeper}, that offers tourists 
the possibility to: look for luggage keepers in a certain area; reserve a place for the luggage in 
the selected place; pay for the service when they are at the luggage keeper; and, optionally, rate 
the luggage keeper at the end of the service.

Given the scenario above, consider the following world phenomena:
\begin{itemize}
    \item Every user owns various pieces of luggage.
    \item Every user can carry around various pieces of luggage.
    \item Each piece of luggage can be either safe, or unsafe.
    \item Small shops store the luggage in lockers, where each locker can store at most one piece of luggage. 
\end{itemize}

Consider also the following shared phenomena:
\begin{itemize}
    \item Each locker is opened with an electronic key that is associated with it (the electronic key is regenerated at each use of the locker; also, a locker that does not have an electronic key associated with it is free).
    \item Each user can hold various electronic keys. 
\end{itemize}

Formalize through an Alloy model:
\begin{enumerate}
    \item The world and machine phenomena identified above.
    \item A predicate capturing the domain assumption D1 that a piece of luggage is safe if, and only if, it is with its owner, or it is stored in a locker that has an associated key, and the owner of the piece of luggage holds the key of the locker.
    \item A predicate capturing the requirement R1 that a key opens only one locker.
    \item A predicate capturing the goal G1 that for each user all his/her luggage is safe.
    \item A predicate capturing the operation GenKey that, given a locker that is free, associates with it a new electronic key.
\end{enumerate}
\subsection*{Solution}
The model requested is: 
\begin{lstlisting}[language=alloy]
abstract sig Status{}

one sig Safe extends Status{} 

one sig Unsafe extends Status{}

sig Luggage{
luggageStatus : one Status
}

sig EKey{}

sig User{
owns : set Luggage, carries : set Luggage, hasKeys : set EKey
}

sig Locker{
hasKey : lone EKey, storesLuggage : lone Luggage
}

sig Shop{
lockers : some Locker
}

pred D1 {
all lg : Luggage | lg.luggageStatus in Safe 
iff 
all u : User | lg in u.owns implies ( lg in u.carries or some lk : Locker | lg in lk.storesLuggage and lk.hasKey != none and lk.hasKey in u.hasKeys )
}

pred R1 {
all ek : EKey | no disj lk1, lk2: Locker | ek in lk1.hasKey and ek in lk2.hasKey
}

pred G1 {
all u : User | all lg : Luggage | lg in u.owns implies lg.luggageStatus in Safe
}

pred GenKey[lk, lk' : Locker] {
lk.hasKey = none
lk'.storesLuggage = lk.storesLuggage
one ek : EKey | lk'.hasKey = ek 
}
\end{lstlisting}